<app-sidebar></app-sidebar>

<!-- Page title-->
<div class="border-bottom pt-5 mt-2 mb-5">
    <h1 class="mt-2 mt-md-4 mb-3 pt-5">Balance General</h1>
    <div class="d-flex flex-wrap flex-md-nowrap justify-content-between">
      <p class="text-muted">Estado de situación financiera</p>
      <p class="font-size-sm font-weight-medium pl-md-4">
        <a class="text-nowrap" [routerLink]="['/panel/finanzas']">Regresar<i class="fa fa-angle-right font-size-base align-middle ml-1"></i></a>
      </p>
    </div>
</div>

<!-- Controles -->
<div class="card box-shadow-sm mb-4">
    <div class="card-body">
        <div class="row align-items-end">
            <div class="col-lg-3">
                <label>Fecha de corte</label>
                <input type="date" class="form-control" [(ngModel)]="fecha_corte">
            </div>
            <div class="col-lg-9">
                <button class="btn btn-primary mr-2" (click)="actualizar_balance()">
                    <i class="fa fa-refresh"></i> Actualizar
                </button>
                <button class="btn btn-secondary mr-2" (click)="toggle_detalle()">
                    <i class="fa fa-list"></i> {{ mostrar_detalle ? 'Ocultar' : 'Mostrar' }} Detalle
                </button>
                <button class="btn btn-info mr-2" (click)="imprimir_balance()">
                    <i class="fa fa-print"></i> Imprimir
                </button>
                <button class="btn btn-success" (click)="exportar_excel()">
                    <i class="fa fa-download"></i> Excel
                </button>
            </div>
        </div>
    </div>
</div>

<div *ngIf="load_data" class="text-center py-5">
    <div class="spinner-border" role="status">
        <span class="sr-only">Cargando...</span>
    </div>
</div>

<!-- Balance General -->
<div *ngIf="!load_data && balance" class="card box-shadow-sm">
    <div class="card-header text-center">
        <h4 class="mb-0">BALANCE GENERAL</h4>
        <p class="text-muted mb-0">Al {{ fecha_corte | date:'dd/MM/yyyy' }}</p>
    </div>
    <div class="card-body">
        <div class="row">
            <!-- ACTIVOS -->
            <div class="col-lg-6">
                <h5 class="text-success border-bottom pb-2">ACTIVOS</h5>
                
                <!-- Activos Corrientes -->
                <div class="mb-4">
                    <h6 class="text-primary">Activos Corrientes</h6>
                    <div *ngIf="balance.activos_corrientes" class="ml-3">
                        <div *ngFor="let cuenta of balance.activos_corrientes" class="d-flex justify-content-between">
                            <span>{{ cuenta.nombre }}</span>
                            <span>${{ cuenta.saldo | number:'1.2-2' }}</span>
                        </div>
                        <div class="d-flex justify-content-between font-weight-bold border-top pt-2 mt-2">
                            <span>Total Activos Corrientes</span>
                            <span>${{ balance.totales?.total_activos_corrientes | number:'1.2-2' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Activos No Corrientes -->
                <div class="mb-4">
                    <h6 class="text-primary">Activos No Corrientes</h6>
                    <div *ngIf="balance.activos_no_corrientes" class="ml-3">
                        <div *ngFor="let cuenta of balance.activos_no_corrientes" class="d-flex justify-content-between">
                            <span>{{ cuenta.nombre }}</span>
                            <span>${{ cuenta.saldo | number:'1.2-2' }}</span>
                        </div>
                        <div class="d-flex justify-content-between font-weight-bold border-top pt-2 mt-2">
                            <span>Total Activos No Corrientes</span>
                            <span>${{ balance.totales?.total_activos_no_corrientes | number:'1.2-2' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Total Activos -->
                <div class="bg-success text-white p-3 rounded">
                    <div class="d-flex justify-content-between">
                        <h5 class="mb-0">TOTAL ACTIVOS</h5>
                        <h5 class="mb-0">${{ balance.totales?.total_activos | number:'1.2-2' }}</h5>
                    </div>
                </div>
            </div>

            <!-- PASIVOS Y PATRIMONIO -->
            <div class="col-lg-6">
                <h5 class="text-danger border-bottom pb-2">PASIVOS Y PATRIMONIO</h5>
                
                <!-- Pasivos Corrientes -->
                <div class="mb-4">
                    <h6 class="text-warning">Pasivos Corrientes</h6>
                    <div *ngIf="balance.pasivos_corrientes" class="ml-3">
                        <div *ngFor="let cuenta of balance.pasivos_corrientes" class="d-flex justify-content-between">
                            <span>{{ cuenta.nombre }}</span>
                            <span>${{ cuenta.saldo | number:'1.2-2' }}</span>
                        </div>
                        <div class="d-flex justify-content-between font-weight-bold border-top pt-2 mt-2">
                            <span>Total Pasivos Corrientes</span>
                            <span>${{ balance.totales?.total_pasivos_corrientes | number:'1.2-2' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Pasivos No Corrientes -->
                <div class="mb-4">
                    <h6 class="text-warning">Pasivos No Corrientes</h6>
                    <div *ngIf="balance.pasivos_no_corrientes" class="ml-3">
                        <div *ngFor="let cuenta of balance.pasivos_no_corrientes" class="d-flex justify-content-between">
                            <span>{{ cuenta.nombre }}</span>
                            <span>${{ cuenta.saldo | number:'1.2-2' }}</span>
                        </div>
                        <div class="d-flex justify-content-between font-weight-bold border-top pt-2 mt-2">
                            <span>Total Pasivos No Corrientes</span>
                            <span>${{ balance.totales?.total_pasivos_no_corrientes | number:'1.2-2' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Total Pasivos -->
                <div class="bg-warning text-dark p-2 rounded mb-3">
                    <div class="d-flex justify-content-between">
                        <strong>TOTAL PASIVOS</strong>
                        <strong>${{ balance.totales?.total_pasivos | number:'1.2-2' }}</strong>
                    </div>
                </div>

                <!-- Patrimonio -->
                <div class="mb-4">
                    <h6 class="text-info">Patrimonio</h6>
                    <div *ngIf="balance.patrimonio" class="ml-3">
                        <div *ngFor="let cuenta of balance.patrimonio" class="d-flex justify-content-between">
                            <span>{{ cuenta.nombre }}</span>
                            <span>${{ cuenta.saldo | number:'1.2-2' }}</span>
                        </div>
                        <div class="d-flex justify-content-between font-weight-bold border-top pt-2 mt-2">
                            <span>Total Patrimonio</span>
                            <span>${{ balance.totales?.total_patrimonio | number:'1.2-2' }}</span>
                        </div>
                    </div>
                </div>

                <!-- Total Pasivos y Patrimonio -->
                <div class="bg-danger text-white p-3 rounded">
                    <div class="d-flex justify-content-between">
                        <h5 class="mb-0">TOTAL PASIVOS Y PATRIMONIO</h5>
                        <h5 class="mb-0">${{ balance.totales?.total_pasivos_patrimonio | number:'1.2-2' }}</h5>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verificación de balance -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="alert" [ngClass]="{
                    'alert-success': balance.balanceado,
                    'alert-danger': !balance.balanceado
                }">
                    <div class="d-flex justify-content-between align-items-center">
                        <span>
                            <i [ngClass]="{
                                'fa fa-check': balance.balanceado,
                                'fa fa-close': !balance.balanceado
                            }"></i>
                            {{ balance.balanceado ? 'Balance cuadrado' : 'Balance descuadrado' }}
                        </span>
                        <span *ngIf="balance.diferencia">
                            Diferencia: ${{ balance.diferencia | number:'1.2-2' }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>